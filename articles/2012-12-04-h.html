<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>RailsのView開発用にViewSourceMap.gemつくった</title>
  <link href="https://r7kamura.com/articles/2012-12-04-h" rel="canonical">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="search" type="application/opensearchdescription+xml" title="r7kamura.com" href="/opensearch.xml">
  <link rel="alternate" type="application/rss+xml" href="/feed.xml">
  
  <meta property="description" content="@todesking氏のRails、レンダリングされたHTMLのどこがどのpartialから来たのかをコメントとして埋めるが良かったので、完全にパクって、改良して相対パス名表示するようにして、config/initializers/以下に置いたら開発環境でのみ働くようにしてみた。">
  <meta property="og:description" content="@todesking氏のRails、レンダリングされたHTMLのどこがどのpartialから来たのかをコメントとして埋めるが良かったので、完全にパクって、改良して相対パス名表示するようにして、config/initializers/以下に置いたら開発環境でのみ働くようにしてみた。">
  
  <meta property="og:type" content="website">
  <meta property="og:title" content="RailsのView開発用にViewSourceMap.gemつくった">
  <meta property="og:url" content="https://r7kamura.com/articles/2012-12-04-h">
  
  <meta property="og:image" content="https://camo.githubusercontent.com/a36f31478b184482ce99ac584c779b1d028d52c6/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353937383836392f696d6167652f32303132313230345f3137313632352e706e67">
  <meta property="twitter:card" content="summary_large_image">
  
</head>
<body>
  <header>
    <nav>
      <a href="/">r7kamura.com</a>
      <ul>
        <li>
          <a href="/articles">一覧</a>
        </li>
        <li>
          <a href="https://www.google.com/?as_sitesearch=r7kamura.com">検索</a>
        </li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
  <h1>RailsのView開発用にViewSourceMap.gemつくった</h1>
  <footer>
    <p>
      <time datetime="2012-12-04T00:00:00+00:00">2012年12月04日</time>
    </p>
  </footer>
  <div>
    <p>@todesking氏の<a href="http://d.hatena.ne.jp/gnarl/20121130/1354284297">Rails、レンダリングされたHTMLのどこがどのpartialから来たのかをコメントとして埋める</a>が良かったので、完全にパクって、改良して相対パス名表示するようにして、config/initializers/以下に置いたら開発環境でのみ働くようにしてみた。ここのテキストちょっと弄りたいけどどのファイルに書いてあるの...みたいなケース多いので、ChromeのInspectorとかで見たらHTMLコメントでファイル名分かって便利。render layout: "wrapper" do ... という風にrenderを呼んだときに上手くパス名を取得する方法が分からないので、どなたかよろしくお願いします。</p><br>
<p></p><blockquote class="twitter-tweet" data-lang="HASH(0xa8f1d30)">
<p lang="en" dir="ltr"><a href="https://twitter.com/miyagawa">@miyagawa</a> gemified :) <a href="http://t.co/A3LSJFC1">http://t.co/A3LSJFC1</a></p>— r7kamura (@r7kamura) <a href="https://twitter.com/r7kamura/status/275880118814121984">December 4, 2012</a>
</blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><br>
<p><a href="https://github.com/r7kamura/view_source_map">https://github.com/r7kamura/view_source_map</a><br>
社内チャットで名前募集したら、ishiki-takai-rendererになりかけたんですが、最終的にViewSourceMapになりました。VSMです。考案者達いわくvs. Managerっぽいですねとのことです。本当はパス名を可聴化したかったんですが今回は可視化に留めました。RailsにはRailtieという仕組みがあって、Railtieクラスを継承して、Rails起動時に実行してほしいcallbackを記述できる。Action Mailer, Action Controller, Action View, Active Record and Active Resourceとかは実は全てRailtieを利用してつくられているらしい。算数の9の段っぽい。このGemでもRailtieを継承して、アプリ起動時(config.after_initialize { ... })にrenderの機能を書き換えるという感じで実装した。</p><p>RailsのPluginをGemでつくるときは、rails plugin new view_source_map ってやると、Gemの雛形+それをテストするためのサンプルRailsアプリを生成してくれる。適当にroutingとcontrollerとview弄って、controller-specでviewの内容をテストした。TestCaseの代わりにRSpecが使いたいときは、specフォルダをつくって、あああ説明が面倒ああああああこういう感じです。</p>

<pre class="code" data-lang="" data-unlink>$ rails plugin new view_source_map --skip-test-unit --dummy-path=spec/dummy
$ cd view_source_map
$ vim view_source_map.gemspec
$ cat !$
...
Gem::Specification.new do |s|
  ...
  s.add_development_dependency "rspec-rails"
end

$ cd spec/dummy
$ ln -s ../../spec
$ rails g rspec:install
$ cd -
$ vim spec/spec_helper.rb
$ diff spec/spec_helper.rb
- require File.expand_path("../../config/environment", __FILE__)
+ require File.expand_path("../dummy/config/environment", __FILE__)</pre>

<div class="section">
    <h3>使い方</h3>
    <pre class="code" data-lang="" data-unlink>echo 'gem "view_source_map"' &gt;&gt; Gemfile
rails s</pre>
<p><a href="https://camo.githubusercontent.com/a36f31478b184482ce99ac584c779b1d028d52c6/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353937383836392f696d6167652f32303132313230345f3137313632352e706e67" target="_blank"><img src="https://camo.githubusercontent.com/a36f31478b184482ce99ac584c779b1d028d52c6/687474703a2f2f646c2e64726f70626f782e636f6d2f752f353937383836392f696d6167652f32303132313230345f3137313632352e706e67"></a></p>

</div>

  </div>
</article>

  </main>
</body>
</html>
